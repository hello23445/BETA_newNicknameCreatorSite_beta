<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∏ –Ω–∞–≥—Ä–∞–¥—ã</title>
  <style>
    :root{
      --bg:#060039; /* dark blue */
      --text:#d9d9d9;
      --accent:#251897;
      --card:#0b0b2b;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;-webkit-font-smoothing:antialiased}
    .app{max-width:1100px;margin:24px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .back-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);padding:10px 14px;border-radius:12px;text-decoration:none;font-weight:600}
    .coins{font-weight:700}
    main{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:20px}

    /* left: calendar + tasks */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:18px;box-shadow:0 6px 18px rgba(2,2,8,0.6)}
    .calendar{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
    .day{background:var(--card);border-radius:12px;padding:12px;min-height:88px;display:flex;flex-direction:column;justify-content:space-between}
    .day.claimed{opacity:0.6;box-shadow:inset 0 0 0 2px rgba(0,0,0,0.2)}
    .day.today{outline:2px solid rgba(37,24,151,0.5)}
    .day .num{font-weight:700}
    .day .reward{font-size:13px}
    .day button{margin-top:8px;padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:white;font-weight:600;cursor:pointer}

    /* tasks */
    .tasks-list{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .task{background:var(--glass);border-radius:12px;padding:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
    .task .title{font-weight:700}
    .task .meta{font-size:13px;opacity:0.85;margin-top:6px}
    .task .buttons{display:flex;gap:8px;margin-top:10px}
    .btn{padding:8px 10px;border-radius:10px;border:none;background:var(--accent);color:white;font-weight:700;cursor:pointer;transition: background 0.2s;}
    .btn:hover{background:#3a2ab8;}
    .btn.alt{background:transparent;border:1px solid rgba(255,255,255,0.06);transition: border-color 0.2s;}
    .btn.alt:hover{border-color:rgba(255,255,255,0.12);}

    /* modal */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);justify-content:center;align-items:center;z-index:1000;transition: opacity 0.3s ease;}
    .modal-content{background:var(--card);padding:24px;border-radius:16px;max-width:420px;width:90%;text-align:left;position:relative;box-shadow:0 4px 20px rgba(0,0,0,0.3);animation: fadeIn 0.3s ease;}
    @keyframes fadeIn {from {opacity:0;transform:scale(0.95);} to {opacity:1;transform:scale(1);}}
    .modal-content h1{font-size:20px;font-weight:700;margin-bottom:12px;text-align:center;}
    .modal-content .description{margin-bottom:16px;line-height:1.5;font-size:14px;}
    .modal-content .meta{font-size:16px;font-weight:bold;opacity:0.9;margin-bottom:8px;}
    .modal-content .buttons{display:flex;flex-direction:column;gap:12px;margin-top:20px;}
    .modal-content .buttons button{width:100%;}
    .close-btn{position:absolute;top:16px;right:16px;cursor:pointer;color:var(--text);font-size:24px;transition: color 0.2s;}
    .close-btn:hover{color:white;}

    /* right column */
    .side{position:sticky;top:20px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px}
    .progress{height:10px;background:rgba(255,255,255,0.04);border-radius:10px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#5b3cff);width:0%}

    footer{margin-top:18px;text-align:center;color:rgba(217,217,217,0.6);font-size:13px}

    /* responsive */
    @media (max-width:900px){
      main{grid-template-columns:1fr}
      .coins{font-size:14px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <a class="back-btn" href="main.html">‚óÄ –í–ï–†–ù–£–¢–¨–°–Ø –í –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</a>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="coins" id="coinsDisplay">ü™ô0</div>
      </div>
    </header>

    <main>
      <section class="panel">
        <h2>–ù–∞–≥—Ä–∞–¥—ã</h2>
        <p style="opacity:0.8">–ù–∞–≥—Ä–∞–¥—ã –º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –ø–æ –æ–¥–Ω–æ–π –≤ –¥–µ–Ω—å. –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ü—Ä–µ–º–∏—É–º, —Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–±–∏—Ä–∞—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã.</p>

        <div style="margin-top:14px">
          <div class="calendar" id="calendar"></div>
        </div>
      </section>

      <aside class="side">
        <div class="card">
          <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
            <div>–î–Ω–µ–π —Å–æ–±—Ä–∞–Ω–æ: <span id="collectedCount">0</span>/30</div>
            <div id="currentDayLabel">–î–µ–Ω—å 1</div>
          </div>
          <div style="margin-top:10px" class="progress"><i id="progressBar"></i></div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn" id="collectToday">–ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É (—Å–µ–≥–æ–¥–Ω—è)</button>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card" style="margin-top:12px">
          <h3>–ó–∞–¥–∞–Ω–∏—è</h3>
          <div class="tasks-list" id="tasksList"></div>
        </div>
      </aside>
    </main>

    <footer>
      –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—ë –∑–∞–¥–∞–Ω–∏–µ, —Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏: –í–ï–†–ù–£–¢–¨–°–Ø –í –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ > –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ú–µ–Ω—é > –ù–∞—Å—Ç—Ä–æ–π–∫–∏ > –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Å–≤—è–∑—å"> –ù–∞–∂–º–∏—Ç–µ "–ù–∞–ø–∏—Å–∞—Ç—å –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏"
    </footer>
  </div>

  <!-- Modal -->
  <div id="taskModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="closeModal">&times;</span>
      <h1 id="modalTitle"></h1>
      <div class="description" id="modalDescription"></div>
      <div id="modalExpires" class="meta"></div>
      <div id="modalReward" class="meta"></div>
      <div class="buttons">
        <button class="btn alt" id="modalActionBtn"></button>
        <button class="btn" id="modalCheckBtn"></button>
        <button class="btn alt" id="modalBackBtn">–ù–∞–∑–∞–¥</button>
      </div>
    </div>
  </div>

  <script>
    /* ----------------------
       –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–ø—É–Ω–∫—Ç 2)
       ----------------------*/

        let DAILY_REWARDS = JSON.parse(localStorage.getItem('dailyRewards') || 'null');

        if (!DAILY_REWARDS) {
          DAILY_REWARDS = [];
          const start = 100;
          const end = 5000;
          const days = 29;
          const increment = Math.floor((end - start) / (days - 1));
          for (let i = 0; i < days; i++) {
            DAILY_REWARDS.push(start + i * increment);
          }
          DAILY_REWARDS.push(10000);
          localStorage.setItem('dailyRewards', JSON.stringify(DAILY_REWARDS));
        }


    /* TASKS —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
      id: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π id
      title: –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–¥–∞–Ω–∏—è
      description: —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
      checkText: —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
      actionText: —Ç–µ–∫—Å—Ç –≤—Ç–æ—Ä–æ–π –∫–Ω–æ–ø–∫–∏ (–≤–µ–¥—ë—Ç –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
      actionLink: —Å—Å—ã–ª–∫–∞/—Ñ–∞–π–ª –∫—É–¥–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
      conditionCode: —Å—Ç—Ä–æ–∫–∞ —Å js-–∫–æ–¥–æ–º (–ª—é–±–æ–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω), –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å true –µ—Å–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
      expires: —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ '–¥–¥.–º–º.–≥–≥–≥–≥' (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ)
      rewardText: —Å—Ç—Ä–æ–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–Ω–∞–ø—Ä–∏–º–µ—Ä '100 ü™ô')
      rewardCode: —Å—Ç—Ä–æ–∫–∞ —Å js-–∫–æ–¥–æ–º (–ª—é–±–æ–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω), –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–º —á–∏—Å–ª–æ –º–æ–Ω–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä 'return 100;')
      showConditionCode: —Å—Ç—Ä–æ–∫–∞ —Å js-–∫–æ–¥–æ–º (–ª—é–±–æ–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω), –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å true –µ—Å–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä 'return localStorage.getItem("") === ...;' –∏–ª–∏ 'return !localStorage.getItem("");' –∏–ª–∏ 'return localStorage.getItem("item") === ...;' –∏–ª–∏ 'return localStorage.getItem("item") !== ...;' –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ)
    */

    const TASKS = [
      {
        id: 'task1',
        title: '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª',
        description: '–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å.',
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏',
        actionLink: 'https://t.me/NickNaymes2Bot',
        conditionCode: 'return await checkSubscription();',
        expires: '31.12.2025',
        rewardText: '1 000ü™ô',
        rewardCode: 'return 1000;',
        showConditionCode: 'return localStorage.getItem("userID")'
      },
      {
        id: 'task2',
        title: '–ü—Ä–∏–≤—è–∑–∞—Ç—å —Å–≤–æ–π Telegram ID',
        description: `–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É, –≤–∞–º –Ω—É–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å–≤–æ–π Telegram ID –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
        1. –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.2. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ú–µ–Ω—é".3. –í—ã–±–µ—Ä–∏—Ç–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏".4. –í —Ä–∞–∑–¥–µ–ª–µ "–ê–∫–∫–∞—É–Ω—Ç" –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram ID" –∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π ID.5. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å".`,
        checkText: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        actionText: '–ü–µ—Ä–µ–π—Ç–∏ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
        actionLink: 'main.html',
        conditionCode: "return !!localStorage.getItem('userID');",
        expires: '31.12.2025',
        rewardText: '500ü™ô',
        rewardCode: 'return 500;',
        showConditionCode: 'return true;'
      }
    ];

    async function checkSubscription() {
        // === –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ ===
        let BOT_TOKEN  = "6537497957:AAGZS4adwPVJSlx16YCCDrKjO96rDK7ZstI";       // —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
        let CHANNEL_ID = "@NickNaymes2Bot";          // username –∏–ª–∏ id –∫–∞–Ω–∞–ª–∞
        let USER_ID    = localStorage.getItem('userID');     // id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

        try {
            let url = `https://api.telegram.org/bot${BOT_TOKEN}/getChatMember?chat_id=${CHANNEL_ID}&user_id=${USER_ID}`;
            let response = await fetch(url);
            let data = await response.json();

            if (!data.ok) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", data);
                return false;
            }

            let status = data.result.status;
            console.log("–°—Ç–∞—Ç—É—Å:", status);

            if (status === "member" || status === "administrator" || status === "creator") {
                console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª!");
                return true;
            } else {
                console.log("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –ø–æ–¥–ø–∏—Å–∞–Ω!");
                return false;
            }
        } catch (err) {
            console.error("–û—à–∏–±–∫–∞:", err);
            return false;
        }
    }
    /* ----------------------
       –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
       ----------------------*/
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è localStorage
    if(!localStorage.getItem('coins')) localStorage.setItem('coins','0');
    if(!localStorage.getItem('rewardsStart')) localStorage.setItem('rewardsStart', new Date().toISOString().slice(0,10)); // yyyy-mm-dd
    if(!localStorage.getItem('claimedDays')) localStorage.setItem('claimedDays', JSON.stringify([]));

    const coinsDisplay = document.getElementById('coinsDisplay');
    const calendarEl = document.getElementById('calendar');
    const tasksList = document.getElementById('tasksList');
    const collectedCountEl = document.getElementById('collectedCount');
    const progressBar = document.getElementById('progressBar');
    const currentDayLabel = document.getElementById('currentDayLabel');
    const collectTodayBtn = document.getElementById('collectToday');

    function getCoins(){return parseInt(localStorage.getItem('coins')||'0',10)}
    function setCoins(n){localStorage.setItem('coins', String(n)); renderCoins()}
    function renderCoins(){ coinsDisplay.textContent = `ü™ô${getCoins()}` }

    function getStartDate(){ return new Date(localStorage.getItem('rewardsStart')) }
    function dayIndexFromStart(){
      const start = getStartDate();
      const now = new Date();
      const diff = Math.floor((Date.UTC(now.getFullYear(),now.getMonth(),now.getDate()) - Date.UTC(start.getFullYear(),start.getMonth(),start.getDate()))/86400000);
      return Math.min(29, Math.max(0, diff)); // 0..29
    }

    function getClaimed(){ try{return JSON.parse(localStorage.getItem('claimedDays')||'[]')}catch(e){return []} }
    function setClaimed(arr){ localStorage.setItem('claimedDays', JSON.stringify(arr)); }

    function canClaimIndex(index){
      const claimed = getClaimed();
      if(claimed.includes(index)) return false;
      const todayIndex = dayIndexFromStart();
      if(index === todayIndex) return true;
      // –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ premium === 'yes'
      if(index < todayIndex){
        return localStorage.getItem('premium') === 'yes';
      }
      return false; // future day
    }

    function claimIndex(index){
      if(!canClaimIndex(index)) return false;
      const coins = getCoins() + DAILY_REWARDS[index];
      setCoins(coins);
      const claimed = getClaimed(); claimed.push(index); setClaimed(claimed);
      renderAll();
      return true;
    }

    function formatDate(date){
      const dd = String(date.getDate()).padStart(2, '0');
      const mm = String(date.getMonth() + 1).padStart(2, '0');
      const yyyy = date.getFullYear();
      return `${dd}.${mm}.${yyyy}`;
    }

    function renderCalendar(){
      calendarEl.innerHTML='';
      const claimed = getClaimed();
      const todayIndex = dayIndexFromStart();
      const start = getStartDate();
      const now = new Date();
      for(let i=0;i<30;i++){
        const day = document.createElement('div'); day.className='day';
        if(claimed.includes(i)) day.classList.add('claimed');
        if(i===todayIndex) day.classList.add('today');
        day.innerHTML = `<div><div class="num">–î–µ–Ω—å ${i+1}</div><div class="reward">${DAILY_REWARDS[i]} ü™ô</div></div>`;
        const btn = document.createElement('button');
        if(claimed.includes(i)){
          btn.textContent='–ó–∞–±—Ä–∞–Ω–æ'; btn.disabled=true; btn.style.opacity=0.6
        } else if(i>todayIndex){
          const futureDate = new Date(start.getFullYear(), start.getMonth(), start.getDate() + i);
          const timeDiff = futureDate.getTime() - now.getTime();
          const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
          const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
          let remainingParts = [];
          if (days > 0) remainingParts.push(`${days} –¥.`);
          if (hours > 0) remainingParts.push(`${hours}—á.`);
          if (minutes > 0) remainingParts.push(`${minutes}–º.`);
          if (seconds > 0 || remainingParts.length === 0) remainingParts.push(`${seconds}—Å.`);
          btn.textContent=`–î–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑: ${remainingParts.join(' ')}`; btn.disabled=true
        } else if(i<todayIndex && localStorage.getItem('premium')!=='yes'){
          btn.textContent='–ü—Ä–æ–ø—É—â–µ–Ω–æ (—Ç–æ–ª—å–∫–æ –ø—Ä–µ–º–∏—É–º)'; btn.disabled=true
        } else {
          btn.textContent='–ó–∞–±—Ä–∞—Ç—å';
          btn.onclick = ()=>{ if(claimIndex(i)) showToast(`–ü–æ–ª—É—á–µ–Ω–æ ${DAILY_REWARDS[i]} ü™ô`); else showToast('–ù–µ–ª—å–∑—è –∑–∞–±—Ä–∞—Ç—å') }
        }
        day.appendChild(btn);
        calendarEl.appendChild(day);
      }
    }

    function renderTasks(){
      tasksList.innerHTML='';
      const now = new Date();
      for(const t of TASKS){
        let shouldShow = true;
        if (t.showConditionCode) {
          try {
            const fn = new Function(t.showConditionCode);
            shouldShow = fn();
          } catch(e) { console.error(e); shouldShow = false; }
        }
        if (!shouldShow) continue;
        const taskEl = document.createElement('div'); taskEl.className='task';
        const expiresDate = parseDateDDMMYYYY(t.expires);
        const expired = expiresDate && (new Date(expiresDate.getFullYear(),expiresDate.getMonth(),expiresDate.getDate()) < new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()));
        let isClaimed = !!localStorage.getItem(t.id + '_claimed');
        taskEl.innerHTML = `<div class="title">${t.title} (${t.rewardText})</div>`;
        const btn = document.createElement('button'); btn.className='btn';
        if (isClaimed) {
          btn.textContent = '–ó–∞–±—Ä–∞–Ω–æ';
          btn.disabled = true;
          btn.style.opacity = 0.6;
        } else {
          btn.textContent = t.checkText;
          btn.onclick = async (e)=>{
            e.stopPropagation();
            try{
              const getFn = new Function('return async function() {' + t.conditionCode + '}');
              const fn = getFn();
              const res = await fn();
              if(res){
                const rewardFn = new Function(t.rewardCode);
                const amount = parseInt(rewardFn(),10)||0;
                setCoins(getCoins()+amount);
                localStorage.setItem(t.id + '_claimed', 'true');
                showToast(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –ø–æ–ª—É—á–µ–Ω–æ ${amount} ü™ô`);
                renderAll();
              } else {
                showToast('–£—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
              }
            }catch(e){ console.error(e); showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∑–∞–¥–∞–Ω–∏—è'); }
          };
        }
        taskEl.appendChild(btn);
        taskEl.onclick = () => showModal(t);
        tasksList.appendChild(taskEl);
      }
    }

    function parseDateDDMMYYYY(s){
      if(!s) return null; const parts = s.split('.'); if(parts.length!==3) return null; const d=parseInt(parts[0],10), m=parseInt(parts[1],10)-1, y=parseInt(parts[2],10); return new Date(y,m,d);
    }

    function renderProgress(){
      const claimed = getClaimed();
      const percent = Math.round((claimed.length/30)*100);
      progressBar.style.width = percent+'%';
      collectedCountEl.textContent = claimed.length;
      currentDayLabel.textContent = `–î–µ–Ω—å ${dayIndexFromStart()+1}`;
    }

    function renderCollectToday(){
      const today = dayIndexFromStart();
      if(getClaimed().includes(today)){
        collectTodayBtn.disabled = true;
        collectTodayBtn.style.opacity = 0.6;
        collectTodayBtn.textContent = '–ó–∞–±—Ä–∞–Ω–æ (—Å–µ–≥–æ–¥–Ω—è)';
      } else {
        collectTodayBtn.disabled = false;
        collectTodayBtn.style.opacity = 1;
        collectTodayBtn.textContent = '–ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É (—Å–µ–≥–æ–¥–Ω—è)';
      }
    }

    function renderAll(){ renderCoins(); renderCalendar(); renderTasks(); renderProgress(); renderCollectToday(); }

    // collect today button
    collectTodayBtn.addEventListener('click', ()=>{
      const today = dayIndexFromStart();
      if(getClaimed().includes(today)) return showToast('–°–µ–≥–æ–¥–Ω—è —É–∂–µ –∑–∞–±—Ä–∞–ª–∏');
      if(claimIndex(today)) showToast(`–ü–æ–ª—É—á–µ–Ω–æ ${DAILY_REWARDS[today]} ü™ô`); else showToast('–ù–µ–ª—å–∑—è –∑–∞–±—Ä–∞—Ç—å');
    });

    // toast
    function showToast(text){
      const t = document.createElement('div'); t.textContent = text; t.style.position='fixed'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.bottom='26px'; t.style.background='rgba(0,0,0,0.6)'; t.style.color='white'; t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.zIndex=9999; document.body.appendChild(t);
      setTimeout(()=>{ t.style.transition='all 300ms'; t.style.opacity=0; setTimeout(()=>t.remove(),300) },1800);
    }

    // modal
    const modal = document.getElementById('taskModal');
    const closeModal = document.getElementById('closeModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalDescription = document.getElementById('modalDescription');
    const modalExpires = document.getElementById('modalExpires');
    const modalReward = document.getElementById('modalReward');
    const modalActionBtn = document.getElementById('modalActionBtn');
    const modalCheckBtn = document.getElementById('modalCheckBtn');
    const modalBackBtn = document.getElementById('modalBackBtn');

    function showModal(task){
      modalTitle.textContent = task.title;
      modalDescription.textContent = task.description;
      const expiresDate = parseDateDDMMYYYY(task.expires);
      const expired = expiresDate && (new Date(expiresDate.getFullYear(),expiresDate.getMonth(),expiresDate.getDate()) < new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()));
      if (task.expires) {
        modalExpires.textContent = `–î–æ: ${task.expires}${expired ? ' ¬∑ –ò—Å—Ç—ë–∫' : ''}`;
      } else {
        modalExpires.textContent = '';
      }
      modalReward.textContent = `–ù–∞–≥—Ä–∞–¥–∞: ${task.rewardText}`;
      modalActionBtn.textContent = task.actionText;
      modalActionBtn.onclick = () => { window.location.href = task.actionLink };
      let isClaimed = !!localStorage.getItem(task.id + '_claimed');
      if (isClaimed) {
        modalCheckBtn.textContent = '–ó–∞–±—Ä–∞–Ω–æ';
        modalCheckBtn.disabled = true;
        modalCheckBtn.style.opacity = 0.6;
        modalCheckBtn.onclick = null;
      } else {
        modalCheckBtn.textContent = task.checkText;
        modalCheckBtn.onclick = async () => {
          try{
            const getFn = new Function('return async function() {' + t.conditionCode + '}');
            const fn = getFn();
            const res = await fn();
            if(res){
              const rewardFn = new Function(task.rewardCode);
              const amount = parseInt(rewardFn(),10)||0;
              setCoins(getCoins()+amount);
              localStorage.setItem(task.id + '_claimed', 'true');
              showToast(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –ø–æ–ª—É—á–µ–Ω–æ ${amount} ü™ô`);
              renderAll();
              modal.style.display = 'none';
            } else {
              showToast('–£—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
            }
          }catch(e){ console.error(e); showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∑–∞–¥–∞–Ω–∏—è'); }
        };
      }
      modal.style.display = 'flex';
    }

    closeModal.onclick = () => { modal.style.display = 'none'; };
    modalBackBtn.onclick = () => { modal.style.display = 'none'; };
    window.onclick = (event) => { if (event.target === modal) modal.style.display = 'none'; };

    // initial render
    renderAll();

    // Update dynamic elements every second to keep timers live
    setInterval(() => {
      renderCalendar();
      renderProgress();
      renderCollectToday();
    }, 1000);

    // Convenience: expose TASKS and DAILY_REWARDS to window for easy editing in console
    window.APP = {TASKS,DAILY_REWARDS};

  </script>
</body>
</html>